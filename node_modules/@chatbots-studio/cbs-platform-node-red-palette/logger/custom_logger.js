const stringify = require('fast-safe-stringify');

module.exports = (node) => {
  const infoToLog = {
    timestamp: new Date().toISOString(),
    _stage: process.env.NODE_ENV,
    _application: process.env.APPLICATION_NAME || 'Node-RED',
  }

  return {
    addParam: (name, value) => {
      if (typeof value === 'object') {
        value = stringify(value);
      }

      infoToLog[name] = value;
    },

    getFullLog: () => {
      return infoToLog;
    },

    getParam: (param) => {
      return infoToLog[param];
    },

    logInfo: () => {
      node.log(infoToLog);
    },

    logError: () => {
      node.error(infoToLog);
    }
  }
};
