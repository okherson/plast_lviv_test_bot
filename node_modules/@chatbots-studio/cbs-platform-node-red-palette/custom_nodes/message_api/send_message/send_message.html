<script type="text/javascript">
  {
    RED.nodes.registerType("send-message", {
      category: "messageAPI",
      color: "#D8BFD8",
      defaults: {
        isTimerUsed: { value: false },
        language: {
          value: "",
          required: true,
          validate: RED.validators.typedInput("languageType"),
        },
        languageType: { value: "msg" },
        messageOption: { value: "" },
        messageID: { value: "", required: false },
        messageIDType: { value: "str" },
        name: { value: "" },
        payload: {
          value: "",
          validate: RED.validators.typedInput("payloadType"),
        },
        payloadType: { value: "str" },
        props: { value: {} },
        templateId: { value: "" },
        templateIdToDelete: { value: "" },
        templatesJsons: { value: {} },
        templatesList: { value: [] },
        userID: {
          value: "",
          required: true,
          validate: RED.validators.typedInput("userIDType"),
        },
        userIDType: { value: "msg" },
        traceID: {
          value: "",
          required: true,
          validate: RED.validators.typedInput("traceIDType"),
        },
        traceIDType: { value: "msg" },

        useTimer: { value: false },
        timer: { value: "" },
        outputs: { value: 3 },

        // Create template properties
        jsonToCreate: { value: "" },
        jsonToCreateType: { value: "json" },
        templateDescriptionButtonsContainerToCreate: { value: [] },
        templateDesciptionDetailsToCreate: { value: "", required: true },
        templateDesciptionTextToCreate: { value: "" },
        templateIdToCreate: { value: "" },
        templateGroupToCreate: { value: "", required: true },

        // Current template properties
        currentTemplateDescription: { value: {} },
        currentTemplateGroup: { value: "" },
        currentTemplateTimer: { value: "" },
        currentTemplateType: { value: "" },

        // Edit template properties
        jsonToEdit: { value: "" },
        jsonToEditType: { value: "json" },
        templateIdToEdit: { value: "" },
        templateDescriptionButtonsContainerToEdit: { value: [] },
        templateDesciptionDetailsToEdit: { value: "" },
        templateDesciptionTextToEdit: { value: "" },
      },
      inputs: 1,
      outputs: 1,
      icon: "font-awesome/fa-envelope-o",
      label: function () {
        return this.name || "send-message";
      },
      outputLabels: [
        "Success response",
        "4xx errors",
        "5xx errors",
        "TimerHook callback",
      ],
      oneditprepare: function () {
        const node = this;

        $(".button-go-back").on("click", goBack);

        $("#node-input-property-container")
          .css("min-height", "150px")
          .css("max-height", "450px")
          .editableList({
            addButton: false,
            addItem: function (container, i, opt) {
              let prop = opt;

              container.css({
                overflow: "hidden",
                whiteSpace: "nowrap",
              });

              let row = $("<div/>")
                .attr({ class: "node-input-property-row" })
                .appendTo(container);

              $("<p/>", {
                class: "node-input-prop-property-name",
                "data-value": prop.property,
              })
                .css({
                  width: "30%",
                  display: "inline-block",
                  padding: "0 6px",
                })
                .text(prop.property)
                .appendTo(row);

              let propertyValue = $("<input/>", {
                class: "node-input-prop-property-value",
                type: "text",
              })
                .css("width", "calc(70% - 20px)")
                .appendTo(row)
                .typedInput({
                  default: "msg",
                  types: [
                    "msg",
                    "flow",
                    "global",
                    "str",
                    "num",
                    "bool",
                    "json",
                    "bin",
                    "date",
                    "env",
                  ],
                });

              propertyValue.typedInput("value", prop.value);
              propertyValue.typedInput("type", prop.valueType);
            },
            sortable: true,
          });

        $("#node-input-property-container-templateDescriptionButtonsToCreate")
          .css("min-height", "30px")
          .css("max-height", "200px")
          .editableList({
            addButton: true,
            addItem: function (container, i, opt) {
              container.css({
                overflow: "hidden",
                whiteSpace: "nowrap",
              });

              let row = $("<div/>")
                .attr({ class: "node-input-property-row" })
                .appendTo(container);

              let propertyValue = $("<input/>", {
                class: "node-input-prop-property-value",
                type: "text",
                value: opt.value,
              })
                .css("width", "100%")
                .appendTo(row);
            },
            sortable: true,
            removable: true,
          });

        $("#node-input-property-container-templateDescriptionButtonsToEdit")
          .css("min-height", "30px")
          .css("max-height", "200px")
          .editableList({
            addButton: true,
            addItem: function (container, i, opt) {
              container.css({
                overflow: "hidden",
                whiteSpace: "nowrap",
              });

              let row = $("<div/>")
                .attr({ class: "node-input-property-row" })
                .appendTo(container);

              let propertyValue = $("<input/>", {
                class: "node-input-prop-property-value",
                type: "text",
                value: opt.value,
              })
                .css("width", "100%")
                .appendTo(row);
            },
            sortable: true,
            removable: true,
          });

        templateVarsHandler(
          node.templateId,
          node.templatesJsons[node.templateId],
          node
        );

        loadTemplateNamesListForAutocomplete(node);

        $("#node-input-templateId").on("blur", () => getTemplateHandler(node));
        $("#node-input-templateId").on("focus", () => {
          $("#node-button-edit-template-tab").attr("disabled", true);
        });

        $("#node-button-create-template-tab").on("click", () =>
          openCreateTemplateTab(node)
        );
        $("#node-button-edit-template-tab").on("click", () =>
          openEditTemplateTab(node)
        );

        $("#node-button-create-template").on("click", () =>
          createTemplateClickHandler(node)
        );
        $("#node-button-save-edited-template-changes").on("click", () =>
          editTemplateClickHandler(node)
        );

        $("#node-button-delete-template").on("click", () =>
          deleteTemplateClickHandler(node)
        );

        $("#node-input-createWithTimer").on("click", () =>
          updateTimerToCreateOptions()
        );
        $("#node-input-useTimer").on("click", () => updateTimerOptions());

        standardJsonsHandler(node);

        configureInputs();
      },
      oneditsave: function () {
        const selectedTemplate = $("#node-input-templateId").val();
        const props = $("#node-input-property-container").editableList("items");
        const node = this;

        node.props[selectedTemplate] = [];

        delete node.payload;
        delete node.payloadType;

        props.each(function () {
          let prop = $(this);
          let p = {
            property: prop.find(".node-input-prop-property-name")[0].dataset
              .value,
          };

          if (p.property) {
            p.value = prop
              .find(".node-input-prop-property-value")
              .typedInput("value");
            p.valueType = prop
              .find(".node-input-prop-property-value")
              .typedInput("type");

            node.props[selectedTemplate].push(p);
          }
        });

        configureNodeOutputs(node);
      },
      oneditresize: resizeDialog,
    });

    function configureInputs() {
      $("#node-input-traceID").typedInput({
        default: "msg",
        types: ["msg"],
        typeField: $("#node-input-traceIDType"),
      });

      $("#node-input-userID").typedInput({
        default: "msg",
        types: ["msg"],
        typeField: $("#node-input-userIDType"),
      });

      $("#node-input-language").typedInput({
        default: "msg",
        types: ["msg"],
        typeField: $("#node-input-languageType"),
      });

      $("#node-input-messageID").typedInput({
        default: "str",
        types: ["str", "msg"],
        typeField: $("#node-input-messageIDType"),
      });

      $("#node-input-jsonToEdit").typedInput({
        default: "json",
        types: ["json"],
        typeField: $("#node-input-jsonToEditType"),
      });

      $("#node-input-jsonToCreate").typedInput({
        default: "json",
        types: ["json"],
        typeField: $("#node-input-jsonToCreateType"),
      });
    }

    function configureNodeOutputs(node) {
      if (node.isTimerUsed || node.currentTemplateTimer) {
        $("#node-input-outputs").val("4");
      } else {
        $("#node-input-outputs").val("3");
      }
    }

    function loadTemplateNamesListForAutocomplete(node) {
      $.ajax({
        url: "templatesList",
        type: "GET",
        success: function (res) {
          const { data, error } = res;

          if (error) {
            RED.notify(
              node._("Template names list was not loaded", {
                message: node._(error.message),
              }),
              "warning"
            );
            return;
          }

          node.templatesList = data;

          // RED.notify(node._('Template names list loaded successfully'), 'success');
          $("#node-input-templateId").autocomplete({
            source: data,
          });
          return data;
        },
        error: function (jqXHR, textStatus, errorThrown) {
          RED.notify(
            node._("Template names list was not loaded", {
              message: node._(errorThrown),
            }),
            "warning"
          );
        },
      });
    }

    function getButtonsForDescription(elementsArr) {
      const buttons = [];
      elementsArr.each(function () {
        const button = $(this).find(".node-input-prop-property-value").val();

        buttons.push(button);
      });

      return buttons;
    }

    function getTemplateHandler(node) {
      const templateId = $("#node-input-templateId").val();

      $.ajax({
        url: "template/" + templateId,
        type: "GET",
        success: (res) => {
          const { data, error } = res;

          if (error) {
            RED.notify(
              node._(`Template ${templateId} was not loaded`, {
                message: node._(error.message),
              }),
              "error"
            );
            templateVarsHandler(null, {}, node);

            return;
          }

          templateVarsHandler(templateId, data.json, node);
          node.templatesJsons[templateId] = data.json;
          node.currentTemplateDescription = data.description || {};
          node.currentTemplateGroup = data.group;
          node.currentTemplateTimer = data.timer;
          node.currentTemplateType = data.type;
          $("#node-button-edit-template-tab").attr("disabled", false);

          RED.notify(
            node._(`Template ${templateId} loaded successfully`),
            "success"
          );
        },
        error: (jqXHR, textStatus, errorThrown) => {
          console.log("Error: ", errorThrown);
        },
      });
    }

    function templateVarsHandler(templateId, templateJSON = {}, node) {
      $("#no-variables-message").hide();

      const templateVarsRegExp = /(?<={{).*?(?=}})/g;

      const propertyContainer = $("#node-input-property-container");

      propertyContainer.empty();

      const varsFromLocalization =
        templateJSON["en"] || templateJSON["uk"] || templateJSON["ru"] || {};
      const newVars = [];
      const vars = node.props[templateId] || [];
      let result;

      while ((result = templateVarsRegExp.exec(JSON.stringify(templateJSON)))) {
        const variable = result[0];

        if (Object.keys(varsFromLocalization).includes(variable)) {
          continue;
        }

        const indexInArray = vars.findIndex((el) => el.property === variable);
        newVars.push({
          property:
            (vars[indexInArray] && vars[indexInArray].property) || variable,
          value: (vars[indexInArray] && vars[indexInArray].value) || "",
          valueType: (vars[indexInArray] && vars[indexInArray].valueType) || "",
        });
      }

      if (!newVars.length) {
        $("#no-variables-message").show();
      }

      node.isTimerUsed = !!newVars.find((v) => v.property === "timer");

      for (const prop of newVars) {
        propertyContainer.editableList("addItem", prop);
      }
    }

    function goBack() {
      $("#dialog-form").children().hide();
      $("#node-config-template-tab-send-message").show();
    }

    function openCreateTemplateTab(node) {
      $("#dialog-form").children().hide();
      $("#node-config-template-editor-tab-create").show();

      const templateButtonsDescriptionContainer = $(
        "#node-input-property-container-templateDescriptionButtonsToCreate"
      );

      templateDescriptionButtonsHandler(
        node.templateDescriptionButtonsContainerToCreate,
        templateButtonsDescriptionContainer
      );
    }

    function openEditTemplateTab(node) {
      const templateId = $("#node-input-templateId").val();

      if (!templateId) {
        return;
      }

      let json = node.templatesJsons[templateId];
      const { buttons, details, text } = node.currentTemplateDescription;
      const group = node.currentTemplateGroup;
      const timer = node.currentTemplateTimer;
      const type = node.currentTemplateType;

      if (typeof json === "object") {
        json = JSON.stringify(json);
      }

      $("#node-input-templateIdToEdit").val(templateId);
      $("#node-input-jsonToEdit").typedInput("value", json);
      $(`#node-input-templateTypeToEdit`).val(type);
      $(`#node-input-templateGroupToEdit`).val(group);
      $(`#node-input-templateDesciptionTextToEdit`).val(text);
      $(`#node-input-templateDesciptionDetailsToEdit`).val(details);

      const templateButtonsDescriptionContainer = $(
        "#node-input-property-container-templateDescriptionButtonsToEdit"
      );

      templateDescriptionButtonsHandler(
        buttons,
        templateButtonsDescriptionContainer
      );

      if (timer) {
        $("#node-input-useTimer").prop("checked", true);
        $("#node-input-timer").val(timer);
      } else {
        $("#node-input-useTimer").prop("checked", false);
        $("#node-input-timer").val("");
      }

      updateTimerOptions();

      $("#dialog-form").children().hide();
      $("#node-config-template-editor-tab-edit").show();
    }

    function createTemplateClickHandler(node) {
      const buttonsArr = $(
        "#node-input-property-container-templateDescriptionButtonsToCreate"
      ).editableList("items");
      const buttons = getButtonsForDescription(buttonsArr);

      node.templateDescriptionButtonsContainerToCreate = buttons;

      const description = {
        buttons: (buttons.length && buttons) || undefined,
        details:
          $(`#node-input-templateDesciptionDetailsToCreate`).val() || undefined,
        text:
          $(`#node-input-templateDesciptionTextToCreate`).val() || undefined,
      };
      const group = $("#node-input-templateGroupToCreate").val();
      const type = $("#node-input-templateTypeToCreate").val();
      const json = $("#node-input-jsonToCreate").typedInput("value");
      const useTimer = $("#node-input-createWithTimer").is(":checked");
      const timerValue = $("#node-input-addTimer").val();
      let parsedJson;

      const templateId = $("#node-input-templateIdToCreate").val();
      let message = `Create new template "${templateId}"?`;
      let btnText = "Create";

      if (node.templatesList.includes(templateId)) {
        message = `Template "${templateId}" already exists in Database. Overwrite data?`;
        btnText = "Overwrite";
      }

      const notification = RED.notify(message, {
        modal: true,
        fixed: true,
        buttons: [
          {
            text: "Cancel",
            click: function () {
              notification.close();
            },
          },
          {
            text: btnText,
            class: "primary",
            click: async () => {
              const newTemplate = {
                description,
                group,
                json,
                templateId,
                type,
              };

              if (useTimer && timerValue) {
                newTemplate.timer = timerValue;
              }

              await createTemplateConfirmed(newTemplate, node);

              if (typeof json === "string") {
                parsedJson = JSON.parse(json);
              } else {
                parsedJson = json;
              }

              notification.close();

              $("#node-input-templateId").val(templateId);

              await templateVarsHandler(templateId, parsedJson, node);
              node.currentTemplateDescription = description;
              node.templatesJsons[templateId] = parsedJson;
              node.currentTemplateGroup = group;
              node.currentTemplateTimer = newTemplate.timer;
              node.currentTemplateType = type;

              await configureNodeOutputs(node);

              setTimeout(goBack, 500);
            },
          },
        ],
      });
    }

    function createTemplateConfirmed(body, node) {
      const { templateId } = body;

      $.ajax({
        url: "template/" + templateId,
        type: "POST",
        data: body,
        success: (res) => {
          const { data, error } = res;

          if (error) {
            RED.notify(
              node._(`Template ${templateId} was not created`, {
                message: node._(error.message),
              }),
              "error"
            );
            return;
          }

          RED.notify(
            node._(`Template ${templateId} successfully created`),
            "success"
          );
          loadTemplateNamesListForAutocomplete(node);
        },
        error: (jqXHR, textStatus, errorThrown) => {
          RED.notify(
            node._("Template was not created", {
              message: node._(errorThrown),
            }),
            "error"
          );
        },
      });
    }

    function editTemplateClickHandler(node) {
      const buttonsArr = $(
        "#node-input-property-container-templateDescriptionButtonsToEdit"
      ).editableList("items");
      const buttons = getButtonsForDescription(buttonsArr);

      node.templateDescriptionButtonsContainerToEdit = buttons;

      const description = {
        buttons: (buttons.length && buttons) || undefined,
        details:
          $(`#node-input-templateDesciptionDetailsToEdit`).val() || undefined,
        text: $(`#node-input-templateDesciptionTextToEdit`).val() || undefined,
      };
      const group = $("#node-input-templateGroupToEdit").val();
      let newJson = $("#node-input-jsonToEdit").val();
      const templateId = $("#node-input-templateIdToEdit").val();
      const useTimer = $("#node-input-useTimer").is(":checked");
      const timerValue = $("#node-input-timer").val();
      const type = $("#node-input-templateTypeToEdit").val();

      const notification = RED.notify(
        `Update data in template "${templateId}"?`,
        {
          modal: true,
          fixed: true,
          buttons: [
            {
              text: "Cancel",
              click: function () {
                notification.close();
              },
            },
            {
              text: "Update",
              class: "primary",
              click: async () => {
                const newTemplate = {
                  description,
                  group,
                  newJson,
                  templateId,
                  type,
                };

                if (useTimer && timerValue) {
                  newTemplate.timer = timerValue;
                }

                await editTemplateConfirmed(newTemplate, node);

                if (typeof newJson === "string") {
                  newJson = JSON.parse(newJson);
                }

                notification.close();

                $("#node-input-templateId").val(templateId);

                await templateVarsHandler(templateId, newJson, node);
                node.templatesJsons[templateId] = newJson;
                node.currentTemplateDescription = description;
                node.currentTemplateTimer = (useTimer && timerValue) || "";
                node.currentTemplateType = type;
                node.currentTemplateGroup = group;
                await configureNodeOutputs(node);

                setTimeout(goBack, 500);
              },
            },
          ],
        }
      );
    }

    function editTemplateConfirmed(body, node) {
      const { templateId } = body;

      $.ajax({
        url: "template/" + templateId,
        type: "PUT",
        data: body,
        success: (res) => {
          const { data, error } = res;

          if (error) {
            RED.notify(
              node._(`Template ${templateId} was not updated`, {
                message: node._(error.message),
              }),
              "error"
            );
            return;
          }

          RED.notify(
            node._(`Template ${templateId} successfully updated`),
            "success"
          );
        },
        error: (jqXHR, textStatus, errorThrown) => {
          RED.notify(
            node._("Template was not updated", {
              message: node._(errorThrown),
            }),
            "error"
          );
        },
      });
    }

    function deleteTemplateClickHandler(node) {
      const templateId = $("#node-input-templateId").val();

      if (!templateId) {
        RED.notify('To delete a template, you need to specify "templateId"', {
          type: "info",
        });

        return;
      }

      const notification = RED.notify(`Delete template "${templateId}"?`, {
        type: "warning",
        modal: true,
        fixed: true,
        buttons: [
          {
            text: "Cancel",
            click: function () {
              notification.close();
            },
          },
          {
            text: "Delete",
            class: "primary",
            click: async () => {
              await deleteTemplateConfirmed(templateId, node);

              $("#node-input-templateId").val("");
              templateVarsHandler(null, {}, node);

              notification.close();
            },
          },
        ],
      });
    }

    function deleteTemplateConfirmed(templateId, node) {
      $.ajax({
        url: "template/" + templateId,
        type: "DELETE",
        success: (res) => {
          const { data, error } = res;

          if (error) {
            RED.notify(
              node._(`Template ${templateId} was not deleted`, {
                message: node._(error.message),
              }),
              "error"
            );
            return;
          }

          delete node.templatesJsons[templateId];
          node.currentTemplateDescription = {};
          node.currentTemplateGroup = "";
          node.currentTemplateTimer = "";
          node.currentTemplateType = "";

          RED.notify(
            node._(`Template ${templateId} successfully deleted`),
            "success"
          );
          loadTemplateNamesListForAutocomplete(node);
        },
        error: (jqXHR, textStatus, errorThrown) => {
          RED.notify(
            node._("Template was not deleted", {
              message: node._(errorThrown),
            }),
            "error"
          );
        },
      });
    }

    function standardJsonsHandler(node) {
      $.ajax({
        url: "standard-templates",
        type: "GET",
        success: (res) => {
          const { data, error } = res;

          if (error) {
            RED.notify(
              node._(`Standard templates were not loaded`, {
                message: node._(error.message),
              }),
              "error"
            );

            return;
          }

          let select = $("#node-input-standardJson");

          select.on("change", () => {
            let key = $("#node-input-standardJson").val();

            const value = res[key] && JSON.stringify(res[key].json);

            $("#node-input-jsonToCreate").typedInput("value", value);

            $("#help-link").attr({ href: res[key].helpLink });
          });

          Object.entries(res).forEach(([key, value], index) => {
            let option = $("<option>")
              .attr({ value: key })
              .text(key)
              .appendTo(select);

            if (!index) {
              $("#node-input-jsonToCreate").typedInput(
                "value",
                JSON.stringify(value.json)
              );
              $("#help-link").attr({ href: value.helpLink });
            }
          });
        },
        error: (jqXHR, textStatus, errorThrown) => {
          console.log("Error: ", errorThrown);
        },
      });
    }

    function templateDescriptionButtonsHandler(buttonsArr = [], container) {
      container.empty();

      for (const button of buttonsArr) {
        container.editableList("addItem", { value: button });
      }
    }

    function updateTimerToCreateOptions() {
      if ($("#node-input-createWithTimer").is(":checked")) {
        $("#node-input-createWithTimer-row").show();
      } else {
        $("#node-input-createWithTimer-row").hide();
      }
    }

    function updateTimerOptions() {
      if ($("#node-input-useTimer").is(":checked")) {
        $("#node-input-useTimer-row").show();
      } else {
        $("#node-input-useTimer-row").hide();
      }
    }

    function resizeDialog(size) {
      size = size || { height: $(".red-ui-tray-content form").height() };
      let rows = $(
        "#node-config-template-tab-send-message>div:not(.node-input-property-container-row)"
      );
      let height = size.height;
      for (let i = 0; i < rows.length; i++) {
        height -= $(rows[i]).outerHeight(true);
      }

      let editorRow = $(
        "#node-config-template-tab-send-message>div.node-input-property-container-row"
      );
      height -=
        parseInt(editorRow.css("marginTop")) +
        parseInt(editorRow.css("marginBottom"));
      height += 16;
      $("#node-input-property-container").editableList("height", height);
    }
  }
</script>

<style>
  .link {
    color: blue !important;
    cursor: pointer;
  }

  .ui-autocomplete {
    overflow-y: auto;
  }
</style>

<script type="text/html" data-template-name="send-message">
  <div id="node-config-template-tab-send-message">
    <div class="form-row">
      <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
      <input
        type="text"
        id="node-input-name"
        placeholder="Name"
        style="width: 70%"
      />
      <input type="hidden" id="node-input-outputs" />
    </div>

    <div class="form-row">
      <label for="node-input-traceID"><i class="fa fa-tag"></i> traceID</label>
      <input type="text" id="node-input-traceID" style="width: 70%" />
      <input type="hidden" id="node-input-traceIDType" />
    </div>

    <div class="form-row">
      <b>Recipient</b>
    </div>

    <div class="form-row">
      <label for="node-input-userID"
        ><i class="fa fa-id-card"></i> User ID</label
      >
      <input type="text" id="node-input-userID" style="width: 70%" />
      <input type="hidden" id="node-input-userIDType" />
    </div>

    <div class="form-row">
      <label for="node-input-language"
        ><i class="fa fa-language"></i> Language</label
      >
      <input type="text" id="node-input-language" style="width: 70%" />
      <input type="hidden" id="node-input-languageType" />
    </div>

    <div class="form-row">
      <label for="node-input-messageID"
        ><i class="fa fa-link"></i> Message ID</label
      >
      <input
        type="text"
        id="node-input-messageID"
        style="width: 70%"
        placeholder="Leave empty 'string' if no need to use"
      />
      <input type="hidden" id="node-input-messageIDType" />
    </div>

    <div class="form-row">
      <b>Template Settings</b>
    </div>

    <div class="form-row">
      <label for="node-input-templateId"> Template ID</label>
      <input type="text" id="node-input-templateId" />
    </div>

    <div class="form-row">
      <div style="display:inline-block; margin-right:8px;">
        Working with templates:
      </div>
      <div style="display:inline-block">
        <button
          id="node-button-create-template-tab"
          type="button"
          class="red-ui-button"
        >
          Create new
        </button>
        <button
          id="node-button-edit-template-tab"
          type="button"
          class="red-ui-button"
        >
          Edit
        </button>
        <button
          id="node-button-delete-template"
          type="button"
          class="red-ui-button"
        >
          Delete
        </button>
      </div>
    </div>

    <div class="form-row">
      <span>Template Variables: </span>
      <b id="no-variables-message" style="display:none"
        >No variables provided for this template</b
      >
    </div>

    <div class="form-row node-input-property-container-row">
      <ol id="node-input-property-container"></ol>
    </div>
  </div>

  <div id="node-config-template-editor-tab-create" style="display:none;">
    <div class="form-row">
      <b>Create new template</b>
    </div>

    <div class="form-row">
      <label for="node-input-templateIdToCreate"> Template ID</label>
      <input type="text" id="node-input-templateIdToCreate" />
    </div>

    <div class="form-row">
      <label for="node-input-templateGroupToCreate">Group</label>
      <input type="text" id="node-input-templateGroupToCreate" />
    </div>

    <div class="form-row">
      <label for="node-input-templateTypeToCreate">Type</label>
      <select id="node-input-templateTypeToCreate" style="width: 70%">
        <option value="error">error</option>
        <option value="finish">finish</option>
        <option value="standard" selected>standard</option>
        <option value="start">start</option>
      </select>
    </div>

    <div class="form-row">
      <label for="node-input-standardJson">Standard JSONs</label>
      <select id="node-input-standardJson" style="width: 70%"></select>
    </div>

    <div class="form-row">
      <label for="node-input-jsonToCreate">JSON</label>
      <input type="text" id="node-input-jsonToCreate" style="width: 70%" />
      <input type="hidden" id="node-input-jsonToCreateType" />
    </div>

    <div class="form-row">
      <input
        type="checkbox"
        id="node-input-createWithTimer"
        style="display: inline-block; width: auto; vertical-align: top;"
      />
      <label for="node-input-createWithTimer" style="width: auto;"
        >Add Timer</label
      >
      <div id="node-input-createWithTimer-row" class="hide">
        <label
          style="width: auto; margin-left: 20px; margin-right: 10px;"
          for="node-input-addTimer"
        >
          <i class="fa fa-clock-o"></i>
          <span>Set timer for</span>
        </label>
        <input type="number" id="node-input-addTimer" style="width: 80px;" />
        <span>seconds</span>
      </div>
    </div>

    <div class="form-row">
      <b>Template Description</b>
    </div>

    <div class="form-row">
      <label for="node-input-templateDesciptionTextToCreate">Text</label>
      <textarea
        id="node-input-templateDesciptionTextToCreate"
        style="width: 70%"
        rows="1"
      ></textarea>
    </div>

    <div class="form-row" style="display:flex; align-items:center;">
      <label
        for="node-input-property-container-templateDescriptionButtonsToCreate"
        style="margin-right:4px"
        >Buttons</label
      >
      <div
        id="node-input-templateDesciptionAddButtonAreaToCreate"
        class="node-input-property-container-row"
        style="width: 70%; display: inline-block;"
      >
        <ol
          id="node-input-property-container-templateDescriptionButtonsToCreate"
        ></ol>
      </div>
    </div>

    <div class="form-row">
      <label for="node-input-templateDesciptionDetailsToCreate">Details</label>
      <textarea
        id="node-input-templateDesciptionDetailsToCreate"
        style="width: 70%"
        rows="1"
      ></textarea>
    </div>

    <div class="form-row">
      <a id="help-link" class="link" target="_blank">Help</a>
    </div>

    <div class="form-row" style="text-align: center;">
      <button
        id="node-button-create-template"
        type="button"
        class="red-ui-button primary"
      >
        Create template
      </button>
      <button type="button" class="red-ui-button button-go-back">Back</button>
    </div>
  </div>

  <div id="node-config-template-editor-tab-edit" style="display:none;">
    <div class="form-row">
      <label for="node-input-templateIdToEdit"> Template ID</label>
      <input type="text" id="node-input-templateIdToEdit" disabled />
    </div>

    <div class="form-row">
      <label for="node-input-templateGroupToEdit">Group</label>
      <input type="text" id="node-input-templateGroupToEdit" />
    </div>

    <div class="form-row">
      <label for="node-input-templateTypeToEdit">Type</label>
      <select id="node-input-templateTypeToEdit" style="width: 70%">
        <option value="error">error</option>
        <option value="finish">finish</option>
        <option value="standard">standard</option>
        <option value="start">start</option>
      </select>
    </div>

    <div class="form-row">
      <label for="node-input-jsonToEdit">Edit JSON</label>
      <input type="text" id="node-input-jsonToEdit" style="width: 70%" />
      <input type="hidden" id="node-input-jsonToEditType" />
    </div>

    <div class="form-row">
      <input
        type="checkbox"
        id="node-input-useTimer"
        style="display: inline-block; width: auto; vertical-align: top;"
      />
      <label for="node-input-useTimer" style="width: auto;">Use Timer</label>
      <div id="node-input-useTimer-row" class="hide">
        <label
          style="width: auto; margin-left: 20px; margin-right: 10px;"
          for="node-input-timer"
        >
          <i class="fa fa-clock-o"></i>
          <span>Set timer for</span>
        </label>
        <input type="text" id="node-input-timer" style="width: 80px;" />
        <span>seconds</span>
      </div>
    </div>

    <div class="form-row">
      <b>Template Description</b>
    </div>

    <div class="form-row">
      <label for="node-input-templateDesciptionTextToEdit">Text</label>
      <textarea
        id="node-input-templateDesciptionTextToEdit"
        style="width: 70%"
        rows="1"
      ></textarea>
    </div>

    <div class="form-row" style="display:flex; align-items:center;">
      <label
        for="node-input-property-container-templateDescriptionButtonsToEdit"
        style="margin-right:4px"
        >Buttons</label
      >
      <div
        id="node-input-templateDesciptionAddButtonAreaToEdit"
        class="node-input-property-container-row"
        style="width: 70%; display: inline-block;"
      >
        <ol
          id="node-input-property-container-templateDescriptionButtonsToEdit"
        ></ol>
      </div>
    </div>

    <div class="form-row">
      <label for="node-input-templateDesciptionDetailsToEdit">Details</label>
      <textarea
        id="node-input-templateDesciptionDetailsToEdit"
        style="width: 70%"
        rows="1"
      ></textarea>
    </div>

    <div class="form-row" style="text-align: center;">
      <button
        id="node-button-save-edited-template-changes"
        type="button"
        class="red-ui-button primary"
      >
        Save changes
      </button>
      <button type="button" class="red-ui-button button-go-back">Back</button>
    </div>
  </div>
</script>

<script type="text/html" data-help-name="send-message">
  <p>Request to send messages</p>
</script>
